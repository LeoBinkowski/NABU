		.Z80
		.XLIST
   		EXTRN PUTLOGO,PACBOARD,PACCOL,SPACSP,KEYPRS,SCRN2
		INCLUDE A:LINKTAB.EXA
		INCLUDE A:COMMON.MRO
		INCLUDE A:STRUCT.MRO
		.LIST
		.RADIX 10
;
  ;DEFINE THE MESSAGE BLOCK
;
MESG1: 		DEFMSG 20,5,'PAC MAN'
MESG2:		DEFMSG 3,12,'READY TO GO? PRESS GO'
MESG3:		DEFMSG 3,14,'NEED HELP?   PRESS HELP'
MESG4:		DEFMSG 3,16,'NEW CHOICE?  PRESS EXIT'
MESG5:		DEFMSG 3,18,'START AGAIN? PRESS RESTART'
MESG6:		DEFMSG 3,21,'***GAME UNDER CONSTRUCTION***'
MESG7:		DEFMSG 3,22,'WATCH OUT FOR FALLING BUGS'
FAKEWD:		'KOOKAMONGA',0DH
PASSMSG:	DEFMSG 3,1,'PASSWORD:'
BUFFER:		DS 11
ALFLAG:		DB	00H
;
;
 ;NOW DEFINE A DATA STRUCTURE POINTING TO THE MESSAGE BLOCKS
;
DATA:		DW MESG1, MESG2, MESG3, MESG4, MESG5
                DW MESG6,MESG7
ENDATA:
;
PTR:		DW 00
PTRCON:		DW 00
;
MENU::   	ASIGN16. (ZAP+2),SCRN2
;Š	LD	IX,NERF
	PUSH	IX
	LD	IX,SETVDP
	JP	(IX)
NERF:	LD	IY,NERF2
	PUSH	IY
	LD	IY,IDENT
	JP	(IY)
NERF2:	PCALL	VFILL 300H,20H,3800H
	LD	A,0FFH
	LD	(ALFLAG),A
;
                PCALL PUTLOGO,02H,0H,2
		PCALL SPNAME,0,04H
		PCALL SPNAME,1,40H
		PCALL SPNAME,2,50H
		PCALL SPCOLR,0,LYELLOW
		PCALL SPCOLR,1,WHITE
		PCALL SPCOLR,2,DRED
		PCALL SPMOVE,0,38H,0C0H
		PCALL SPMOVE,1,38H,7FH
		PCALL SPMOVE,2,38H,7FH
;
 ;LOOP WHILE WRITING THE TEXT LINES ON THE SCREEN.
;
		LD BC,DATA	;SET START POINTER
		LD (PTR),BC
;
		REPEAT.
		LD HL,(PTR)	;GET CONTENTS OF POINTER
		LD A,(HL)
		LD C,A
		INC HL
		LD A,(HL)
		LD B,A
		LD (PTRCON),BC  ;POINTS TO MESSAGE BLOCK
		PCALL PUTMSG,(PTRCON) ;PUT MESSAGE ON SCREEN
		LD HL,(PTR)
		INC HL
		INC HL
		LD (PTR),HL  ;SET FOR NEXT MESSAGE BLOCK
		UNTIL16. (PTR) .EQ. ENDATA  ;DO IT UNTIL DONE
;
		PCALL VBLKOFF   ;UNBLANK SCREEN
;
;
                RET
IDENT:	LD	A,(ALFLAG)
	AND	A
	RET	NZ
	PCALL	PUTMSG,PASSMSG
	;READ A STRING
	;
	PCALL	VBLKOFF
	ASIGN16. (PTR),BUFFER
	WHILE8.	(KEYPRS),.NE.,0DH
	  LD	A,(KEYPRS)
	  AND	A
	  JP	Z,CONT@1
	  LD	HL,(PTR)
	  LD	(HL),A
	  INC	HLŠ	  LD	(PTR),HL
	  ASIGN8. (KEYPRS),00H
	  IF16. (PTR),.GT.,BUFFER+10
	    JP	0000H
	  ENDIF.
CONT@1: ENDW.
	; COMPARE THE STRINGS
ZAP:	LD	IX,PASSWD
	LD	IY,BUFFER
CHKLP:	LD	A,(IX)
	CP	0DH
	JP	Z,NERF2
	LD	C,(IY)
	CP	C
	JP	NZ,0000H
	INC	IX
	INC	IY
	JP	CHKLP
PASSWD:	DB	0DAH,0DAH,0DAH,0C1H,0D5H,0D4H,0C8H,0DH
SETVDP::	PCALL VSETG1        ; SET FOR GRAPHICS MODE
		SETCOLR DBLUE,WHITE ;SET FOR WHITE ON DBLUE
		PCALL VNAMEST,3800H ;NAME TABLE TO START 2000H
		PCALL VPTRNST,0H    ; SET PATTERN START TO 0H
		PCALL VCOLRST,2000H
		PCALL VSPRIST,1800H
		PCALL VATRIST,3C00H
		PCALL RPATRN,PACBOARD	;READ IN TEXT CHARACER SET
		PCALL VFILL,300H,20H,3800H
;
;
                PCALL SPMARK,9  ;SET SPMARK, NO SPRITES
		PCALL SPMOVE,5,0C0H,00H
		PCALL SPMOVE,3,0C0H,00H
		PCALL SPMOVE,4,0C0H,00H
		PCALL SPMOVE,6,0C0H,00H
		PCALL SPMOVE,7,0C0H,00H
		PCALL SPMOVE,8,0C0H,00H
		PCALL LPATRN,SPACSP,1800H
		PCALL VRAML8,20H,PACCOL,2000H
		RET
                END
